---
title: "Readmission or Death After First HF Discharge"
output:
  html_notebook:
    highlight: tango
    number_sections: no
    theme: united
    toc: TRUE
    toc_float: TRUE
    df_print: paged
    code_folding: hide
---

Principal Investigator: John Kostis     
Co-Investigator: Michail Giakoumis, Georgia Barbayannis    
Statistician: Davit Sargsyan     
Date: `r date()`

# Header
```{r Header,echo=FALSE,message=FALSE,error=FALSE,warning=FALSE}
# Load packages
require(data.table)
require(DT)
require(ggplot2)
require(knitr)
require(icd)
require(icd.data)
```

# Part I: Data
```{r data}
load("data/case.RData")

# ATTN! FIX THIS!
case <- case[, -1]

# Make age per 10 year
case$decade <- floor(case$AGE/10)

# Load hospital characteristics and merge
# Source: Georgia's Dakota project
dthosp <- fread("data/NJ HOSPITALS_Heart Attack Scores 2017.csv")
dthosp <- unique(dthosp[, c("Hospital Number",
                            "CLAB",
                            "Area",
                            "Teach")])
colnames(dthosp)[1] <- "HOSP"

# Remove hospitals with missing/ambiguous information
dthosp <- dthosp[-c(16, 45, 62, 73), ]

case$HOSP <- as.numeric(as.character(case$HOSP))
case <- merge(case,
              dthosp,
              by = "HOSP",
              all.x = TRUE)

case$CLAB[is.na(case$CLAB)] <- -1
case$CLAB <- factor(case$CLAB,
                    levels = rev((-1):1),
                    labels = c("Cath Lab",
                               "No Cath Lab",
                               "Unknown"))

case$Area[is.na(case$Area)] <- -1
case$Area <- factor(case$Area,
                    levels = c("U",
                               "I",
                               "R",
                               "S",
                               "-1"),
                    labels = c("Urban",
                               "Inner city",
                               "Rural",
                               "Suburb",
                               "Unknown"))

case$Teach[is.na(case$Teach)] <- -1
case$Teach <- factor(case$Teach,
                    levels = rev((-1):1),
                    labels = c("Teaching",
                               "Non-Teaching",
                               "Unknown"))
```

`r paste("Number of case =", format(nrow(case), big.mark = ","))`


```{r hf_discharges}
# HF discharges----
t1 <- table(case$DSCYR)
t1 <- data.table(Year = as.integer(names(t1)),
                 Counts = c(t1))
dt.age <- aggregate(case$AGE,
                    by = list(Year = case$YEAR),
                    FUN = "mean")
dt.age$x <- round(dt.age$x, 1)
names(dt.age)[2] <- "Age at 1st HF"

dt.age$Year <- as.numeric(dt.age$Year)

t1 <- merge(t1,
            dt.age,
            by = "Year")

DT::datatable(t1,
              caption = "Table 1: Number of first HF discharges by year",
              rownames = FALSE,
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = nrow(t1)))
```

```{r hf_discharges_plot, fig.height = 5, fig.width = 8}
# Plot HF discharges----
p0 <- ggplot(t1,
             aes(x = Year,
                 y = Counts)) +
  geom_line(size = 1) +
  geom_vline(xintercept = c(2000, 2014),
             linetype = "dashed") +
  geom_point(size = 3,
             shape = 21,
             fill = "red") +
  scale_x_continuous("Number of Patients",
                     breaks = 1995:2015,
                     limits = c(1995, 2015)) +
  scale_y_continuous(breaks = seq(0, 15000, 1000),
                     limits = c(0, 15000)) +
  ggtitle(paste("Figure 1: Number of first HF discharges. Total of",
                nrow(case),
                "patients, no prior HF.")) +
  theme(axis.text.x = element_text(angle = 45,
                                   hjust = 1),
        plot.title = element_text(hjust = 0))
p0
```

**NOTE**: the higher number of patients in the early years could be due to censored records containing prior HF; hence, more patients remained. Also, we needed at least one year follow-up for all patients; hence, we restricted records to 2000-2014 interval.

```{r demog}
case <- case[YEAR > 1999 & case$DSCYR < 2015, ]

# Pubication/Table1: Demographics----
# summary(case)

table1 <- t(data.table(`Mean Age at First AMI Admission +/- S.D.` = paste(round(mean(case$AGE), 1),
                                                                          "+/-",
                                                                          round(sd(case$AGE), 1),
                                                                          sep = ""),
                       `Female (%)` = round(100*sum(case$SEX == "F")/nrow(case), 
                                           1),
                       `Race (%)` = "",
                       `* White` = round(100*sum(case$RACE == "White")/nrow(case),
                                         1),
                       `*  Black` = round(100*sum(case$RACE == "Black")/nrow(case),
                                         1),
                       `*  Other` = round(100*sum(case$RACE == "Other")/nrow(case),
                                         1),
                       `Ethnicity (%)` = "",
                       `*  Hispanic` = round(100*sum(case$HISPAN == "Hispanic")/nrow(case), 
                                            1),
                       `*  Non-hispanic` = round(100*sum(case$HISPAN == "Non-Hispanic")/nrow(case), 
                                                1),
                       `*  Unknown` = round(100*sum(case$HISPAN == "Unknown")/nrow(case), 
                                           1),
                       `Insurance(%)` = "",
                       `*  Commercial` = round(100*sum(case$PRIME == "COMMERCIAL")/nrow(case), 
                                              1),
                       `*  Medicare` = round(100*sum(case$PRIME == "medicare")/nrow(case), 
                                            1),
                       `*  Medicaid/Self-Pay/Other` = round(100*sum(case$PRIME == "medicaid/self-pay/other")/nrow(case), 
                                                           1),
                       `Admission Hospital Type (%)` = "",
                       `*  Teaching` = round(100*sum(case$Teach == "Teaching")/nrow(case), 
                                              1),
                       `*  Non-Teaching` = round(100*sum(case$Teach == "Non-Teaching")/nrow(case), 
                                              1),
                       `*  Unknown` = round(100*sum(case$Teach == "Unknown")/nrow(case), 
                                              1),
                       `Admission to Hospital Area (%)` = "",
                       `*  Urban` = round(100*sum(case$Area == "Urban")/nrow(case), 
                                              1), 
                       `*  Inner city` = round(100*sum(case$Area == "Inner city")/nrow(case), 
                                              1), 
                       `*  Rural` = round(100*sum(case$Area == "Rural")/nrow(case), 
                                              1), 
                       `*  Suburb` = round(100*sum(case$Area == "Suburb")/nrow(case), 
                                              1),
                       `*  Unknown` = round(100*sum(case$Area == "Unknown")/nrow(case), 
                                              1), 
                       `Admission Hospital Cath Lab` = "",
                       `*  Cath Lab` = round(100*sum(case$CLAB == "Cath Lab")/nrow(case), 
                                              1),
                       `*  No Cath Lab` = round(100*sum(case$CLAB == "No Cath Lab")/nrow(case), 
                                              1),
                       `*  Unknown` = round(100*sum(case$CLAB == "Unknown")/nrow(case), 
                                              1),
                       `Number of HF Patients` = nrow(case)))
colnames(table1) <- "Summary"

# Save Table1 as CSV
write.csv(table1,
          file = "tmp/table1.csv")

DT::datatable(table1,
              caption = "Table 2: HF pateints' characteristics",
              rownames = TRUE,
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = nrow(table1)))
```  

# Part II: Rates
## All_Cause Readmissions
```{r rates_all_cause_readm}
invisible({
  # 30 days----
  t1 <- addmargins(table(case$DSCYR,
                         case$days2readm < 31 &
                           !is.na(case$days2readm)))
  t1 <- data.table(dschyear = rownames(t1),
                   readm30 = t1[, 2],
                   N = t1[ , 3])
  t1[, rate := round(100*readm30/N, 2)]
  
  # 90 days----
  t2 <- addmargins(table(case$DSCYR,
                         case$days2readm < 91 &
                           !is.na(case$days2readm)))
  t2 <- data.table(dschyear = rownames(t2),
                   readm90 = t2[, 2],
                   N = t2[ , 3])
  t2[, rate := round(100*readm90/N, 2)]
  
  # 180 days----
  t3 <- addmargins(table(case$DSCYR,
                         case$days2readm < 181 &
                           !is.na(case$days2readm)))
  t3 <- data.table(dschyear = rownames(t3),
                   readm180 = t3[, 2],
                   N = t3[ , 3])
  t3[, rate := round(100*readm180/N, 2)]
  
  # 1 year----
  t4 <- addmargins(table(case$DSCYR,
                         case$days2readm < 366 &
                           !is.na(case$days2readm)))
  t4 <- data.table(dschyear = rownames(t4),
                   readm1y = t4[, 2],
                   N = t4[ , 3])
  t4[, rate := round(100*readm1y/N, 2)]
  
  # Combine----
  t1a.apx <- data.table(dschyear = t1$dschyear,
                        rate.30 = t1$rate,
                        rate.90 = t2$rate,
                        rate.180 = t3$rate,
                        rate.1y = t4$rate)
})

colnames(t1a.apx) <- c("HF Discharge Year",
                       "30-Day",
                       "90-Day",
                       "180-Day",
                       "1-Year")
print(DT::datatable(t1a.apx,
                    caption = "Table 3a: all-cause readmissions (%)",
                    rownames = FALSE,
                    
                    class = "cell-border stripe",
                    options = list(searching = TRUE,
                                   pageLength = nrow(t1a.apx))))
```
  
## HF Readmissions
```{r rates_hf_readm}
invisible({
  # 30 days----
  t1 <- addmargins(table(case$DSCYR,
                         case$days2post.hf.dx1 < 31 &
                           !is.na(case$days2post.hf.dx1)))
  t1 <- data.table(dschyear = rownames(t1),
                   hf30 = t1[, 2],
                   N = t1[ , 3])
  t1[, rate := round(100*hf30/N, 2)]
  
  # 90 days----
  t2 <- addmargins(table(case$DSCYR,
                         case$days2post.hf.dx1 < 91 &
                           !is.na(case$days2post.hf.dx1)))
  t2 <- data.table(dschyear = rownames(t2),
                   hf90 = t2[, 2],
                   N = t2[ , 3])
  t2[, rate := round(100*hf90/N, 2)]
  
  # 180 days----
  t3 <- addmargins(table(case$DSCYR,
                         case$days2post.hf.dx1 < 181 &
                           !is.na(case$days2post.hf.dx1)))
  t3 <- data.table(dschyear = rownames(t3),
                   hf180 = t3[, 2],
                   N = t3[ , 3])
  t3[, rate := round(100*hf180/N, 2)]
  
  # 1 year----
  t4 <- addmargins(table(case$DSCYR,
                         case$days2post.hf.dx1 < 366 &
                           !is.na(case$days2post.hf.dx1)))
  t4 <- data.table(dschyear = rownames(t4),
                   hf1y = t4[, 2],
                   N = t4[ , 3])
  t4[, rate := round(100*hf1y/N, 2)]
  
  # Combine----
  t1b.apx <- data.table(dschyear = t1$dschyear,
                        rate.30 = t1$rate,
                        rate.90 = t2$rate,
                        rate.180 = t3$rate,
                        rate.1y = t4$rate)
})
colnames(t1b.apx) <- c("HF Discharge Year",
                       "30-Day",
                       "90-Day",
                       "180-Day",
                       "1-Year")
print(DT::datatable(t1b.apx,
                    caption = "Table 3b: HF readmissions (%)",
                    rownames = FALSE,
                    
                    class = "cell-border stripe",
                    options = list(searching = TRUE,
                                   pageLength = nrow(t1b.apx))))
```

## All-Cause Death
```{r rates_all_cause_death}
invisible({
  # 30 days----
  t1 <- addmargins(table(case$DSCYR,
                         case$days2death < 31 &
                           !is.na(case$days2death)))
  t1 <- data.table(dschyear = rownames(t1),
                   death30 = t1[, 2],
                   N = t1[ , 3])
  t1[, rate := round(100*death30/N, 2)]
  
  # 90 days----
  t2 <- addmargins(table(case$DSCYR,
                         case$days2death < 91 &
                           !is.na(case$days2death)))
  t2 <- data.table(dschyear = rownames(t2),
                   death90 = t2[, 2],
                   N = t2[ , 3])
  t2[, rate := round(100*death90/N, 2)]
  
  # 180 days----
  t3 <- addmargins(table(case$DSCYR,
                         case$days2death < 181 &
                           !is.na(case$days2death)))
  t3 <- data.table(dschyear = rownames(t3),
                   death180 = t3[, 2],
                   N = t3[ , 3])
  t3[, rate := round(100*death180/N, 2)]
  
  # 1 year----
  t4 <- addmargins(table(case$DSCYR,
                         case$days2death < 366 &
                           !is.na(case$days2death)))
  t4 <- data.table(dschyear = rownames(t4),
                   death1y = t4[, 2],
                   N = t4[ , 3])
  t4[, rate := round(100*death1y/N, 2)]
  
  # Combine----
  t1c.apx <- data.table(dschyear = t1$dschyear,
                        rate.30 = t1$rate,
                        rate.90 = t2$rate,
                        rate.180 = t3$rate,
                        rate.1y = t4$rate)
})
colnames(t1c.apx) <- c("HF Discharge Year",
                       "30-Day",
                       "90-Day",
                       "180-Day",
                       "1-Year")
print(DT::datatable(t1c.apx,
                    caption = "Table 3c: all-cause death (%)",
                    rownames = FALSE,
                    
                    class = "cell-border stripe",
                    options = list(searching = TRUE,
                                   pageLength = nrow(t1c.apx))))
```

## CV Death
```{r rates_cv_death}
invisible({
  # 30 days----
  t1 <- addmargins(table(case$DSCYR,
                         case$days2cvdeath < 31 &
                           !is.na(case$days2cvdeath)))
  t1 <- data.table(dschyear = rownames(t1),
                   cvdeath30 = t1[, 2],
                   N = t1[ , 3])
  t1[, rate := round(100*cvdeath30/N, 2)]
  
  # 90 days----
  t2 <- addmargins(table(case$DSCYR,
                         case$days2cvdeath < 91 &
                           !is.na(case$days2cvdeath)))
  t2 <- data.table(dschyear = rownames(t2),
                   cvdeath90 = t2[, 2],
                   N = t2[ , 3])
  t2[, rate := round(100*cvdeath90/N, 2)]
  
  # 180 days----
  t3 <- addmargins(table(case$DSCYR,
                         case$days2cvdeath < 181 &
                           !is.na(case$days2cvdeath)))
  t3 <- data.table(dschyear = rownames(t3),
                   cvdeath180 = t3[, 2],
                   N = t3[ , 3])
  t3[, rate := round(100*cvdeath180/N, 2)]
  
  # 1 year----
  t4 <- addmargins(table(case$DSCYR,
                         case$days2cvdeath < 366 &
                           !is.na(case$days2cvdeath)))
  t4 <- data.table(dschyear = rownames(t4),
                   cvdeath1y = t4[, 2],
                   N = t4[ , 3])
  t4[, rate := round(100*cvdeath1y/N, 2)]
  
  # Combine----
  t1d.apx <- data.table(dschyear = t1$dschyear,
                        rate.30 = t1$rate,
                        rate.90 = t2$rate,
                        rate.180 = t3$rate,
                        rate.1y = t4$rate)
})
colnames(t1d.apx) <- c("HF Discharge Year",
                       "30-Day",
                       "90-Day",
                       "180-Day",
                       "1-Year")
print(DT::datatable(t1d.apx,
                    caption = "Table 3d: CV death (%)",
                    rownames = FALSE,
                    
                    class = "cell-border stripe",
                    options = list(searching = TRUE,
                                   pageLength = nrow(t1d.apx))))
```

```{r rates_plot, fig.width = 8, fig.height = 7}
# Save the table as CSV
table1.apx <- cbind.data.frame(t1a.apx,
                               t1b.apx[, -1],
                               t1c.apx[, -1],
                               t1d.apx[, -1])
tmp <- data.frame(matrix(c("HF Discharge Year",
                           rep(c("30-Day",
                                 "90-Day",
                                 "180-Day",
                                 "1-Year"),
                               4)),
                         nrow = 1))
colnames(tmp) <- colnames(table1.apx)

table1.apx <- rbind.data.frame(tmp,
                               table1.apx)
colnames(table1.apx) <- c("",
                          "All-Cause Readmissions (%)", "", "", "",
                          "HF Readmissions (%)", "", "", "",
                          "All-Cause Death (%)", "", "", "",
                          "CV Death (%)", "", "", "")

write.csv(table1.apx,
          file = "tmp/table1.apx.csv",
          row.names = FALSE)

# Clean memory
invisible({
  rm(tmp)
  gc()
})

# Plot rates----
t1.apx <- list(t1a.apx[-16, ],
               t1b.apx[-16, ],
               t1c.apx[-16, ],
               t1d.apx[-16, ])

names(t1.apx) <- c("All-Cause Readmissions (%)",
                      "HF Readmissions (%)", 
                      "All-Cause Death (%)",
                      "CV Death (%)")

out <- list()
for (i in 1:length(t1.apx)) {
  out[[i]] <- melt.data.table(data = t1.apx[[i]], 
                              id.vars = 1,
                              measure.vars = c(2:5),
                              variable.name = "followup",
                              value.name = "rate")
  out[[i]]$endpoint <- names(t1.apx)[[i]]
}

out <- do.call("rbind", out)

# Re-level follow-up
out$followup <- factor(out$followup,
                       levels = rev(levels(out$followup)))

# Endpoint as a factor
out$endpoint <- factor(out$endpoint,
                       levels = names(t1.apx))

# Figure 1: all rates----
p1 <- ggplot(data = out,
             aes(x = `HF Discharge Year`,
                 y = rate,
                 group = followup,
                 fill = followup)) +
  facet_wrap(~ endpoint,
             nrow = 2,
             scales = "free_y") +
  geom_line(size = 0.5) +
  geom_point(size = 2,
             shape = 21) +
  geom_hline(yintercept = 0,
             linetype = "dashed") +
  scale_x_discrete("1st HF Discharge Year",
                   breaks = unique(out$`HF Discharge Year`),
                   labels = unique(out$`HF Discharge Year`)) +
  scale_y_continuous("Percent (%)") +
  ggtitle("") +
  scale_fill_manual(label = c("1-Year",
                              "180-Day",
                              "90-Day",
                              "30-Day"),
                    values = unique(out$followup)) +
  guides(fill = guide_legend(title = "Follow-up")) +
  theme(legend.position = "top",
        axis.text.x = element_text(angle = 90,
                                   hjust = 0),
        plot.title = element_text(hjust = 0))

# # Saveas TIFF
# tiff(filename = "figure1_rates.tiff",
#      height = 5,
#      width = 12,
#      units = 'in',
#      res = 300,
#      compression = "lzw+p")
# print(p1)
# graphics.off()

p1
```

# Causes for Readmission
```{r readm_causes}
source("source/icd9_dx_get_data_v1.R")
dt.icd <- icd9cm_merge_version_dx(32)

map <- unique(data.table(readm.dx1 = dt.icd$code,
              major = dt.icd$major))

tmp <- case[readm == TRUE, 
            c("Patient_ID",
              "readm.dx1",
              "days2readm")]
tmp <- merge(map,
             tmp,
             by = "readm.dx1")

tmp30 <- tmp[days2readm < 31, ]
t30 <- data.table(table(tmp30$major))
t30$Percent <- round(100*t30$N/sum(t30$N), 1)
t30 <- t30[order(t30$N,
                 decreasing = TRUE),]
DT::datatable(t30,
              caption = "30-Day Readmissions by Cause (DX1)",
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = 20))

tmp90<- tmp[days2readm < 91, ]
t90 <- data.table(table(tmp90$major))
t90$Percent <- round(100*t90$N/sum(t90$N), 1)
t90 <- t90[order(t90$N,
                 decreasing = TRUE),]
DT::datatable(t90,
              caption = "90-Day Readmissions by Cause (DX1)",
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = 20))

tmp180 <- tmp[days2readm < 181, ]
t180 <- data.table(table(tmp180$major))
t180$Percent <- round(100*t180$N/sum(t180$N), 1)
t180 <- t180[order(t180$N,
                 decreasing = TRUE),]
DT::datatable(t180,
              caption = "180-Day Readmissions by Cause (DX1)",
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = 20))

tmp1y <- tmp[days2readm < 366, ]
t1y <- data.table(table(tmp1y$major))
t1y$Percent <- round(100*t1y$N/sum(t1y$N), 1)
t1y <- t1y[order(t1y$N,
                 decreasing = TRUE),]
DT::datatable(t1y,
              caption = "1-Year Readmissions by Cause (DX1)",
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = 20))
```

# Length of Stay
```{r length_of_stay}
# Length of stay
case$los <- as.numeric(difftime(case$DSCHDAT,
                     case$ADMDAT,
                     units = "days"))

# Distribution of length of stay
summary(case$los)
p1 <- ggplot(case[ , "los"],
             aes(x = los)) +
  geom_histogram(bins = 15,
                 color = "black",
                 fill = "green") +
  scale_x_log10("Length of Stay",
                breaks = c(0, 1, 5, 10, 15, 30, 60, 120, 180))
p1
```

**NOTE***: 3,433  patients were discharged at the day of admission. this ight include transfers to other hospitals but we did not look at transfers.

# Part III: Logistic Regression Models
```{r labels}
t2.names <- c("Discharge year",
              "Age (per 10 Years)",
              "Sex (Male)",
              "Race (Black)",
              "Race (Other)",
              "Non-Hispanic vs. Hispanic",
              "Unknown vs. Hispanic",
              "Commercial Insurance vs. Medicare",
              "Medicaid/Self-Pay/Other vs. Medicare",
              "Length of Stay",
              "AFib/AFlutter",
              "AMI",
              "Anemia",
              "CKD",
              "COPD",
              "Diabetes",
              "Hypertension",
              "Hyperlipidemia",
              "Sleep Apnea",
              "Parkinson",
              "Stroke",
              "TIA",
              "Hosp No Cath Lab vs. Cath Lab",
              # "Hosp Unknown vs. Cath Lab",
              "Hosp Inner City Area vs. Urban",
              "Hosp Rural Area vs. Urban",
              "Hosp Suburb Area vs. Urban",
              # "Hosp Unknown Area vs. Urban",
              "Hosp Non-Teaching vs. Teaching")
              # "Hosp Unknown vs. Teaching")

# Discharge year as numeric
case$DSCYR <- as.numeric(case$DSCYR)

# Remove patients from hosps with no info
paste(format(nrow(case[Area == "Unknown", ]),
             big.mark = ","),
      "patients are from hospitals with no info; REMOVE THEM")
case <- droplevels(case[Area != "Unknown", ])
```

## Correlations of binary variables
```{r correlations}
tmp <- case[, haf:htia]
colnames(tmp) <- c("AFib/AFlutter",
                   "AMI",
                   "Anemia",
                   "CKD",
                   "COPD",
                   "Diabetes",
                   "Hypertension",
                   "Hyperlipidemia",
                   "Sleep Apnea",
                   "Parkinson",
                   "Stroke",
                   "TIA")
cor1 <- cor(tmp,
            use = "pairwise.complete.obs")
heatmap(cor1,
        col = rev(heat.colors(10)))
```

Stroke and TIA are highly correlated while hypertension is mildley correlated with hyperlipidemia, diabetes, COPD and AFib/AFlutter.

## All-Cause Readmissions
```{r glm_all_readm, fig.height = 5, fig.width = 15}
case$readm30 <- case$readm90 <- case$readm180 <- case$readm1y <- FALSE
case$readm30[case$days2readm < 31] <- TRUE
case$readm90[case$days2readm < 91] <- TRUE
case$readm180[case$days2readm < 181] <- TRUE
case$readm1y[case$days2readm < 366] <- TRUE

m2a.30 <- glm(readm30 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2a.90 <- glm(readm90 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2a.180 <- glm(readm180 ~ DSCYR +
                 decade +
                 SEX +
                 RACE +
                 HISPAN +
                 PRIME +
                 los +
                 haf +
                 hami +
                 hanemia  +
                 hckd +
                 hcopd +
                 hdiab +
                 hhyper +
                 hlipid  +
                 hosa +
                 hpark +
                 hstroke  +
                 htia +
                 CLAB +
                 Area +
                 Teach,
               family = binomial(logit),
               data = case)

m2a.1y <- glm(readm1y ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

# Combine
s2a <- list(summary(m2a.30),
            summary(m2a.90),
            summary(m2a.180),
            summary(m2a.1y))

t2a <- lapply(s2a, function(a) {
  out <- data.table(names = t2.names,
                    coef = exp(a$coefficients[-1, 1]),
                    lb = exp(a$coefficients[-1, 1] - 1.96*a$coefficients[-1, 2]),
                    ub = exp(a$coefficients[-1, 1] + 1.96*a$coefficients[-1, 2]),
                    pval = ifelse(a$coefficients[-1, 4] >= 0.001,
                                  round(a$coefficients[-1, 4], 3),
                                  "<0.001"),
                    sign = ifelse(a$coefficients[-1, 4] <= 0.05,
                                  ifelse(a$coefficients[-1, 4] <= 0.01,
                                         "**",
                                         "*"), ""))
  rownames(out) <- NULL
  return(out)
})

t2a <- do.call("rbind", t2a)

t2a <- data.table(followup = rep(c("30-Day",
                                   "90-Day",
                                   "180-Day",
                                   "1-Year"),
                                 each = length(t2.names)),
                  t2a)
t2a$names <- factor(t2a$names,
                    levels = unique(t2a$names))
t2a$followup <- factor(as.character(t2a$followup),
                       levels = c("30-Day",
                                  "90-Day",
                                  "180-Day",
                                  "1-Year"))

# Save Table 2A as CSV
t2a$est <- paste(round(t2a$coef, 3),
                 " (",
                 round(t2a$lb, 3),
                 ", ",
                 round(t2a$ub, 3),
                 ")\n",
                 t2a$pval,
                 sep = "")
table2a <- dcast.data.table(data = t2a,
                            names ~ followup,
                            value.var = "est")
colnames(table2a)[1] <- "Risk Factor"

write.csv(table2a,
          file = "tmp/table2a.csv",
          row.names = FALSE)

DT::datatable(table2a,
              caption = "Table2A: All-Cause Readmissions",
              rownames = FALSE,
              options = list(searching = TRUE,
                             pageLength = nrow(table2a)))

# Plot OR----
p2a <- ggplot(t2a,
              aes(x = names,
                  y = coef)) +
  facet_wrap( ~ followup,
              ncol = 2) +
  geom_hline(yintercept = 1,
             colour = "grey",
             size = 1.1,
             linetype = 2) +
  geom_errorbar(aes(ymin = lb,
                    ymax = ub),
                size = 0.4,
                width = 0.2) +
  geom_point(aes(x = names,
                 y = coef,
                 fill = names),
             size = 2,
             shape = 21) +
  scale_fill_manual(labels = paste(LETTERS[1:nlevels(t2a$names)],
                                   levels(t2a$names),
                                   sep = ": "),
                    values = rainbow(nlevels(t2a$names))) +
  scale_x_discrete("Risk Factors",
                   labels = LETTERS[1:nlevels(t2a$names)]) +
  scale_y_continuous("Odds Ratios") +
  ggtitle("Odds Ratios of All-Cause Readmissions") +
  theme(axis.text.x = element_text(size = 12,
                                   hjust = 1),
        axis.text.y = element_text(size = 12),
        text = element_text(size = 12),
        plot.title = element_text(hjust = 0.5)) +
  guides(fill = guide_legend("Risk Factors Legend"))

# # Save Figure2A as TIFF
# tiff(filename = "tmp/figure2a_all_readm_or.tiff",
#      height = 5,
#      width = 11,
#      units = 'in',
#      res = 300,
#      compression = "lzw+p")
# print(p2a)
# graphics.off()

print(p2a)
```

## HF Cause Readmissions
```{r glm_hf_readm, fig.height = 5, fig.width = 15}
# Publication/Table 2a: All-cause readmissions----
case$hf30 <- case$hf90 <- case$hf180 <- case$hf1y <- FALSE
case$hf30[case$days2post.hf.dx1 < 31] <- TRUE
case$hf90[case$days2post.hf.dx1 < 91] <- TRUE
case$hf180[case$days2post.hf.dx1 < 181] <- TRUE
case$hf1y[case$days2post.hf.dx1 < 366] <- TRUE

m2b.30 <- glm(hf30 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2b.90 <- glm(hf90 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2b.180 <- glm(hf180 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
               family = binomial(logit),
               data = case)

m2b.1y <- glm(hf1y ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

# Combine
s2b <- list(summary(m2b.30),
            summary(m2b.90),
            summary(m2b.180),
            summary(m2b.1y))

t2b <- lapply(s2b, function(a) {
  out <- data.table(names = t2.names,
                    coef = exp(a$coefficients[-1, 1]),
                    lb = exp(a$coefficients[-1, 1] - 1.96*a$coefficients[-1, 2]),
                    ub = exp(a$coefficients[-1, 1] + 1.96*a$coefficients[-1, 2]),
                    pval = ifelse(a$coefficients[-1, 4] >= 0.001,
                                  round(a$coefficients[-1, 4], 3),
                                  "<0.001"),
                    sign = ifelse(a$coefficients[-1, 4] <= 0.05,
                                  ifelse(a$coefficients[-1, 4] <= 0.01,
                                         "**",
                                         "*"), ""))
  rownames(out) <- NULL
  return(out)
})

t2b <- do.call("rbind", t2b)

t2b <- data.table(followup = rep(c("30-Day",
                                   "90-Day",
                                   "180-Day",
                                   "1-Year"),
                                 each = length(t2.names)),
                  t2b)
t2b$names <- factor(t2b$names,
                    levels = unique(t2b$names))
t2b$followup <- factor(as.character(t2b$followup),
                       levels = c("30-Day",
                                  "90-Day",
                                  "180-Day",
                                  "1-Year"))

# Save Table 2A as CSV
t2b$est <- paste(round(t2b$coef, 3),
                 " (",
                 round(t2b$lb, 3),
                 ", ",
                 round(t2b$ub, 3),
                 ")\n",
                 t2b$pval,
                 sep = "")
table2b <- dcast.data.table(data = t2b,
                            names ~ followup,
                            value.var = "est")
colnames(table2b)[1] <- "Risk Factor"

write.csv(table2b,
          file = "tmp/table2b.csv",
          row.names = FALSE)

DT::datatable(table2b,
              caption = "Table2B: All-Cause Readmissions",
              rownames = FALSE,
              options = list(searching = TRUE,
                             pageLength = nrow(table2b)))

# Plot OR----
p2b <- ggplot(t2b,
              aes(x = names,
                  y = coef)) +
  facet_wrap( ~ followup,
              ncol = 2) +
  geom_hline(yintercept = 1,
             colour = "grey",
             size = 1.1,
             linetype = 2) +
  geom_errorbar(aes(ymin = lb,
                    ymax = ub),
                size = 0.4,
                width = 0.2) +
  geom_point(aes(x = names,
                 y = coef,
                 fill = names),
             size = 2,
             shape = 21) +
  scale_fill_manual(labels = paste(LETTERS[1:nlevels(t2a$names)],
                                   levels(t2a$names),
                                   sep = ": "),
                    values = rainbow(nlevels(t2a$names))) +
  scale_x_discrete("Risk Factors",
                   labels = LETTERS[1:nlevels(t2a$names)]) +
  scale_y_continuous("Odds Ratios") +
  ggtitle("Odds Ratios of HF Readmissions") +
  theme(axis.text.x = element_text(size = 12,
                                   hjust = 1),
        axis.text.y = element_text(size = 12),
        text = element_text(size = 12),
        plot.title = element_text(hjust = 0.5)) +
  guides(fill = guide_legend("Risk Factors Legend"))

# # Save Figure2B as TIFF
# tiff(filename = "tmp/figure2b_hf_readm_or.tiff",
#      height = 5,
#      width = 11,
#      units = 'in',
#      res = 300,
#      compression = "lzw+p")
# print(p2b)
# graphics.off()

print(p2b)
```

## All-Cause Death
```{r glmAllCauseDeath, fig.height = 5, fig.width = 15}
# Publication/Table 2c: All-cause death----
case$dead30 <- case$dead90 <- case$dead180 <- case$dead1y <- FALSE
case$dead30[case$days2death < 31] <- TRUE
case$dead90[case$days2death < 91] <- TRUE
case$dead180[case$days2death < 181] <- TRUE
case$dead1y[case$days2death < 366] <- TRUE

m2c.30 <- glm(dead30 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2c.90 <- glm(dead90 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2c.180 <- glm(dead180 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
               family = binomial(logit),
               data = case)

m2c.1y <- glm(dead1y ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

# Combine
s2c <- list(summary(m2c.30),
            summary(m2c.90),
            summary(m2c.180),
            summary(m2c.1y))

t2c <- lapply(s2c, function(a) {
  out <- data.table(names = t2.names,
                    coef = exp(a$coefficients[-1, 1]),
                    lb = exp(a$coefficients[-1, 1] - 1.96*a$coefficients[-1, 2]),
                    ub = exp(a$coefficients[-1, 1] + 1.96*a$coefficients[-1, 2]),
                    pval = ifelse(a$coefficients[-1, 4] >= 0.001,
                                  round(a$coefficients[-1, 4], 3),
                                  "<0.001"),
                    sign = ifelse(a$coefficients[-1, 4] <= 0.05,
                                  ifelse(a$coefficients[-1, 4] <= 0.01,
                                         "**",
                                         "*"), ""))
  rownames(out) <- NULL
  return(out)
})

t2c <- do.call("rbind", t2c)

t2c <- data.table(followup = rep(c("30-Day",
                                   "90-Day",
                                   "180-Day",
                                   "1-Year"),
                                 each = length(t2.names)),
                  t2c)
t2c$names <- factor(t2a$names,
                    levels = unique(t2c$names))
t2c$followup <- factor(as.character(t2c$followup),
                       levels = c("30-Day",
                                  "90-Day",
                                  "180-Day",
                                  "1-Year"))

# Save Table 2C as CSV
t2c$est <- paste(round(t2c$coef, 3),
                 " (",
                 round(t2c$lb, 3),
                 ", ",
                 round(t2c$ub, 3),
                 ")\n",
                 t2c$pval,
                 sep = "")
table2c <- dcast.data.table(data = t2c,
                            names ~ followup,
                            value.var = "est")
colnames(table2c)[1] <- "Risk Factor"

write.csv(table2c,
          file = "tmp/table2c.csv",
          row.names = FALSE)

DT::datatable(table2c,
              caption = "Table2C: All-Cause Death",
              rownames = FALSE,
              options = list(searching = TRUE,
                             pageLength = nrow(table2c)))

# Plot OR----
p2c <- ggplot(t2c,
              aes(x = names,
                  y = coef)) +
  facet_wrap( ~ followup,
              ncol = 2) +
  geom_hline(yintercept = 1,
             colour = "grey",
             size = 1.1,
             linetype = 2) +
  geom_errorbar(aes(ymin = lb,
                    ymax = ub),
                size = 0.4,
                width = 0.2) +
  geom_point(aes(x = names,
                 y = coef,
                 fill = names),
             size = 2,
             shape = 21) +
  scale_fill_manual(labels = paste(LETTERS[1:nlevels(t2c$names)],
                                   levels(t2c$names),
                                   sep = ": "),
                    values = rainbow(nlevels(t2c$names))) +
  scale_x_discrete("Risk Factors",
                   labels = LETTERS[1:nlevels(t2c$names)]) +
  scale_y_continuous("Odds Ratios") +
  ggtitle("Odds Ratios of All-Cause Death") +
  theme(axis.text.x = element_text(size = 12,
                                   hjust = 1),
        axis.text.y = element_text(size = 12),
        text = element_text(size = 12),
        plot.title = element_text(hjust = 0.5)) +
  guides(fill = guide_legend("Risk Factors Legend"))

# # Save Figure2C as TIFF
# tiff(filename = "tmp/figure2c_all_death_or.tiff",
#      height = 5,
#      width = 11,
#      units = 'in',
#      res = 300,
#      compression = "lzw+p")
# print(p2c)
# graphics.off()

print(p2c)
```

## CV Death
```{r glmCVdeath, fig.height = 5, fig.width = 15}
# Publication/Table 2d: All-cause readmissions----
case$cvdeath30 <- case$cvdeath90 <- case$cvdeath180 <- case$cvdeath1y <- FALSE
case$cvdeath30[case$days2cvdeath < 31] <- TRUE
case$cvdeath90[case$days2cvdeath < 91] <- TRUE
case$cvdeath180[case$days2cvdeath < 181] <- TRUE
case$cvdeath1y[case$days2cvdeath < 366] <- TRUE

m2d.30 <- glm(cvdeath30 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2d.90 <- glm(cvdeath90 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

m2d.180 <- glm(cvdeath180 ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
               family = binomial(logit),
               data = case)

m2d.1y <- glm(cvdeath1y ~ DSCYR +
                decade +
                SEX +
                RACE +
                HISPAN +
                PRIME +
                los +
                haf +
                hami +
                hanemia  +
                hckd +
                hcopd +
                hdiab +
                hhyper +
                hlipid  +
                hosa +
                hpark +
                hstroke  +
                htia +
                CLAB +
                Area +
                Teach,
              family = binomial(logit),
              data = case)

# Combine
s2d <- list(summary(m2d.30),
            summary(m2d.90),
            summary(m2d.180),
            summary(m2d.1y))

t2d <- lapply(s2d, function(a) {
  out <- data.table(names = t2.names,
                    coef = exp(a$coefficients[-1, 1]),
                    lb = exp(a$coefficients[-1, 1] - 1.96*a$coefficients[-1, 2]),
                    ub = exp(a$coefficients[-1, 1] + 1.96*a$coefficients[-1, 2]),
                    pval = ifelse(a$coefficients[-1, 4] >= 0.001,
                                  round(a$coefficients[-1, 4], 3),
                                  "<0.001"),
                    sign = ifelse(a$coefficients[-1, 4] <= 0.05,
                                  ifelse(a$coefficients[-1, 4] <= 0.01,
                                         "**",
                                         "*"), ""))
  rownames(out) <- NULL
  return(out)
})

t2d <- do.call("rbind", t2d)

t2d <- data.table(followup = rep(c("30-Day",
                                   "90-Day",
                                   "180-Day",
                                   "1-Year"),
                                 each = length(t2.names)),
                  t2d)
t2d$names <- factor(t2d$names,
                    levels = unique(t2d$names))
t2d$followup <- factor(as.character(t2d$followup),
                       levels = c("30-Day",
                                  "90-Day",
                                  "180-Day",
                                  "1-Year"))

# Save Table 2D as CSV
t2d$est <- paste(round(t2d$coef, 3),
                 " (",
                 round(t2d$lb, 3),
                 ", ",
                 round(t2d$ub, 3),
                 ")\n",
                 t2d$pval,
                 sep = "")
table2d <- dcast.data.table(data = t2d,
                            names ~ followup,
                            value.var = "est")
colnames(table2d)[1] <- "Risk Factor"

write.csv(table2d,
          file = "tmp/table2d.csv",
          row.names = FALSE)

DT::datatable(table2d,
              caption = "Table2D: CV Death",
              rownames = FALSE,
              options = list(searching = TRUE,
                             pageLength = nrow(table2d)))

# Plot OR----
p2d <- ggplot(t2d,
              aes(x = names,
                  y = coef)) +
  facet_wrap( ~ followup,
              ncol = 2) +
  geom_hline(yintercept = 1,
             colour = "grey",
             size = 1.1,
             linetype = 2) +
  geom_errorbar(aes(ymin = lb,
                    ymax = ub),
                size = 0.4,
                width = 0.2) +
  geom_point(aes(x = names,
                 y = coef,
                 fill = names),
             size = 2,
             shape = 21) +
  scale_fill_manual(labels = paste(LETTERS[1:nlevels(t2a$names)],
                                   levels(t2a$names),
                                   sep = ": "),
                    values = rainbow(nlevels(t2a$names))) +
  scale_x_discrete("Risk Factors",
                   labels = LETTERS[1:nlevels(t2a$names)]) +
  scale_y_continuous("Odds Ratios") +
  ggtitle("Odds Ratios of CV Death") +
  theme(axis.text.x = element_text(size = 12,
                                   hjust = 1),
        axis.text.y = element_text(size = 12),
        text = element_text(size = 12),
        plot.title = element_text(hjust = 0.5)) +
  guides(fill = guide_legend("Risk Factors Legend"))

# # Save Figure2D as TIFF
# tiff(filename = "tmp/figure2d_cv_death_or.tiff",
#      height = 5,
#      width = 11,
#      units = 'in',
#      res = 300,
#      compression = "lzw+p")
# print(p2d)
# graphics.off()

p2d
```

# Appendix
## ICD Codes
### Diagnoses (ICD-9)
```{r icd9, echo = FALSE, message = FALSE, warning = FALSE, error = FALSE}
l1 <- fread("data/midas.hf_icd9_codes_2019-05-10.csv",
            colClasses = c("character"))

# Converto to comorbidity map----
l1 <- as.comorbidity_map(split(x = l1$code,
                               f = l1$comorb))

# Cancer----
source("source/icd9_dx_get_data_v1.R")
dt.icd <- icd9cm_merge_version_dx(32)
l.cancer <- dt.icd[dt.icd$major_code %in% c(140:209,
                                            235:239), ]
# NOTE: excludes binign neoplasms, ICD9 210-229

# Combine all malignant cancers
l1$cancer <- l.cancer$code

# Table1 appendix: ICD-9 mapping----
l2 <- lapply(l1,
             function(a) {
               a <- icd::short_to_decimal(a)
               paste(a,
                     collapse = "; ")
             })
table1app <- data.table(Comorbidity = names(l2),
                        `ICD-9` = do.call("rbind",
                                          l2))
table1app <- data.table(Comorbidity = c("AFib/AFlutter",
                                        "AMI",
                                        "Anemia",
                                        "CKD",
                                        "COPD",
                                        "Diabetes",
                                        "HF",
                                        "Hypertension",
                                        "Hyperlipidemia",
                                        "Sleep Apnea",
                                        "Parkinson",
                                        "Stroke",
                                        "TIA",
                                        "Cancer"),
                        Variable = table1app$Comorbidity,
                        ICD9 = table1app$`ICD-9.V1`)

# # Save Table1 Appendix as CSV
# write.csv(table1app,
#           file = "tmp/table1app.csv",
#           row.names = FALSE)

DT::datatable(table1app,
              caption = "Appendix Table 1: ICD-9 codes for comorbidities",
              class = "cell-border stripe",
              rownames = FALSE,
              options = list(searching = TRUE,
                             pageLength = nrow(table1app)))
```

### Cause of CV death (ICD-10)
```{r icd10, echo = FALSE, message = FALSE, warning = FALSE, error = FALSE}
t2 <- data.table(Diagnosis = c("Major cardiovascular diseases",
                               "Diseases of heart",
                               "Hypertensive heart disease with or without renal disease",
                               "Ischemic heart diseases",
                               "Other diseases of heart",
                               "Essential (primary) hypertension and hypertensive renal disease",
                               "Cerebrovascular diseases",
                               "Atherosclerosis",
                               "Other diseases of circulatory system"),
                 `ICD-10` = c("I00-I78",
                              "I00-I09, I11, I13, I20-I51",
                              "I11,I13",
                              "I20-I25",
                              "I00-I09,I26-I51",
                              "I10,I12",
                              "I60-I69",
                              "I70",
                              "I71-I78"))
DT::datatable(t2,
              caption = "Appendix Table 2: CID-10 codes for cause of death",
              rownames = FALSE,
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = nrow(t1)))
```

## Abbreviations
```{r abbreviations}
abbv <- data.table(Abbreviation = c("AMI",
                                    "HF"),
                   Description = c("Acute myocardial infarction",
                                   "Heart failure"))
setkey(abbv, 
       Abbreviation)
DT::datatable(abbv,
              caption = "Appendix Table 3: abbreviations",
              class = "cell-border stripe",
              options = list(searching = TRUE,
                             pageLength = nrow(t1)))
```


## Session Info
```{r}
sessionInfo()
```